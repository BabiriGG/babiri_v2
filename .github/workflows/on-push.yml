name: Statsugiri CI

on: [push]

jobs:
    formatting-check:
        name: Formatting Check
        runs-on: ubuntu-latest
        strategy:
            matrix:
                python-version: ["3.9"]
        steps:
            - name: Checkout
              uses: actions/checkout@v2

            # checks-out the repository under $GITHUB_WORKSPACE
            - name: Set up Python ${{ matrix.python-version }}
              uses: actions/setup-python@v2
              with:
                  python-version: ${{ matrix.python-version }}

            - name: Root Environment Setup
              run: |
                  pip install -r ./requirements.txt

            - name: Check formatting
              run: |
                  ./formatting_scripts/check_formatting_ci.sh

    pytest:
        name: PS Ingestion Tests
        runs-on: ubuntu-latest
        strategy:
            matrix:
                python-version: ["3.9"]
        steps:
            - name: Checkout
              uses: actions/checkout@v2

            # checks-out the repository under $GITHUB_WORKSPACE
            - name: Set up Python ${{ matrix.python-version }}
              uses: actions/setup-python@v2
              with:
                  python-version: ${{ matrix.python-version }}

            - name: PS Ingestion environment setup
              working-directory: ./src/ps_ingestion_lambda
              run: |
                  pip install -r requirements.txt

            - name: Run Pytest
              working-directory: ./src/ps_ingestion_lambda
              run: |
                  pytest .
